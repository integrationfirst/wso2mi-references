<?xml version="1.0" encoding="UTF-8"?>
<sequence name="Read_Email_And_Send_To_Kafka" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <log>
        <property name="Message" value="Processing mailbox"/>
    </log>
    <email.list configKey="imapsconnection">
        <deleteAfterRetrieve>false</deleteAfterRetrieve>
    </email.list>
    <log level="full">
        <property name="Message" value="List email completed"/>
    </log>
    <foreach expression="//emails/email">
        <sequence>
            <log level="full">
                <property name="Message" value="Process each email"/>
            </log>
            <email.getEmailBody>
                <emailIndex>0</emailIndex>
            </email.getEmailBody>
            <log level="full"/>
        </sequence>
    </foreach>
    <log>
        <property name="Message" value="Process email completed"/>
    </log>
    <respond/>
</sequence>
