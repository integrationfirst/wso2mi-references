<?xml version="1.0" encoding="UTF-8"?>
<sequence name="Form_Submit_File_To_SFTP" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <log>
        <property name="Message" value="Start processing file"/>
    </log>
    <propertyGroup>
        <property expression="$body/mediate/fileContent/@filename" name="filename" scope="default" type="STRING"/>
        <property expression="$body/mediate/subPath" name="subPath" scope="default" type="STRING"/>
        <property expression="$body/mediate/subPath" name="sftpDir" scope="default" type="STRING"/>
    </propertyGroup>
    <payloadFactory media-type="xml">
        <format>
            <ns:binary xmlns:ns="http://ws.apache.org/commons/ns/payload">$1</ns:binary>
        </format>
        <args>
            <arg evaluator="xml" expression="$body/mediate/fileContent"/>
        </args>
    </payloadFactory>
    <sequence key="Upload_To_SFTP_Seq"/>
    <!-- 7. We define a success message to be the respose of the REST API request. -->
    <payloadFactory media-type="json">
        <format>{
			"file": "$1",
			"statusMessage" : "Upload successfully"
}
		</format>
        <args>
            <arg evaluator="xml" expression="$ctx:filename"/>
        </args>
    </payloadFactory>
    <respond/>
</sequence>
