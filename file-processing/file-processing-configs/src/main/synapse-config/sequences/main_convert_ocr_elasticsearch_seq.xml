<?xml version="1.0" encoding="UTF-8"?>
<sequence name="main_convert_ocr_elasticsearch_seq" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <propertyGroup>
        <property expression="$body/mediate/fileUrl" name="fileUrl" scope="default" type="STRING"/>
        <property expression="$body/mediate/toFileFormat" name="toFileFormat" scope="default" type="STRING"/>
        <property expression="$body/mediate/bucket" name="bucket" scope="default" type="STRING"/>
        <property expression="$body/mediate/traceId" name="traceId" scope="default" type="STRING"/>
    </propertyGroup>
    <sequence key="Convert_File"/>
    <propertyGroup>
        <property expression="json-eval($.fileUrl)" name="filePath" scope="default" type="STRING"/>
    </propertyGroup>
    <sequence key="Textract_OCR"/>
    <propertyGroup>
        <property expression="json-eval($.rawText)" name="rawText" scope="default" type="STRING"/>
    </propertyGroup>
    <file.write configKey="LOCAL_FILE_DIR">
        <filePath>{fn:concat('/Users/thminh_1/Documents/BreakerPOD/100 samples/VietnamTest/',$ctx:shortFilename,'_textract.txt')}</filePath>
        <contentOrExpression>{$ctx:rawText}</contentOrExpression>
        <mimeType>text/plain</mimeType>
        <compress>false</compress>
        <writeMode>Overwrite</writeMode>
        <enableStreaming>false</enableStreaming>
        <appendNewLine>false</appendNewLine>
        <enableLock>false</enableLock>
        <includeResultTo>Message Body</includeResultTo>
        <updateLastModified>true</updateLastModified>
    </file.write>
    <sequence key="Azure_OpenAI"/>
    <propertyGroup>
        <property expression="json-eval($.choices[0].message.content)" name="aiData" scope="default" type="STRING"/>
    </propertyGroup>
    <file.write configKey="LOCAL_FILE_DIR">
        <filePath>{fn:concat('/Users/thminh_1/Documents/BreakerPOD/100 samples/VietnamTest/',$ctx:shortFilename,'_openai.txt')}</filePath>
        <contentOrExpression>{$ctx:aiData}</contentOrExpression>
        <mimeType>text/plain</mimeType>
        <compress>false</compress>
        <writeMode>Overwrite</writeMode>
        <enableStreaming>false</enableStreaming>
        <appendNewLine>false</appendNewLine>
        <enableLock>false</enableLock>
        <includeResultTo>Message Body</includeResultTo>
        <updateLastModified>true</updateLastModified>
    </file.write>
    <respond/>
</sequence>
